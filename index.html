<!doctype html>
<meta charset="utf-8">
<title>Node.js Mini-Course</title>
<style>

body {
	margin-bottom: 200px;
}

h2.section {
	margin-top: 120px;
}

pre, code, tt, textarea {
	font-family: "Menlo", "Monaco", "Courier New", monospace;
}

tt, .select-all {
	background: #eee;
}

td {
	vertical-align: top;
	padding: 8px;
}

pre.file {
	white-space: pre-wrap;
	background-color: #ddd;
	color: #334;
	padding: 8px;
	border-radius: 4px;
	border: 0;
}
pre.file span.slot {
	background: #fff;
	cursor: pointer;
}
pre.file span.slot:hover {
	background: #ffc;
}

pre.terminal {
	white-space: pre-wrap;
	background-color: #000;
	color: #ccc;
	padding: 8px;
	border-radius: 4px;
	border: 0;
}
pre.terminal .prompt {
	color: #fff;
}
pre.terminal .input {
	color: #ff0;
	/*font-weight: bold;*/
}

div.popup {
	position: absolute;
	display: inline-block;
	max-width: 20em;
	background: #fff;
	border-radius: 8px;
	border: 1px solid #ccc;
	padding: 8px;
	box-shadow: 4px 4px 4px #888;
}

</style>

<h1>Node.js Mini-Course</h1>

<h2>What's Node.js?</h2>

<p><a href="http://nodejs.org/">Node.js</a> is a platform for writing network applications (such as web servers) in JavaScript.

<h2>Why Node.js?</h2>

<p>You could be using <a href="http://rubyonrails.org/">Ruby on Rails</a>, <a href="https://www.djangoproject.com/">Django</a>, or <a href="http://php.net/" title="Why would you use this?">PHP</a>. Why write your web server with <a href="http://nodejs.org/">Node.js</a>?

<ul>
<li><strong>You already know JavaScript.</strong> More or less.
<li><strong>You want to handle many simultaneous connections.</strong> JavaScript's event-driven execution model is well-suited to "real-time" applications like chat and collaborative editors where many people will have connections open to the server for long periods of time.
<li><strong>Node.js is minimalistic.</strong> Node.js programmers tend to make libraries that you can plug into your project, rather than frameworks that you're supposed to plug your project into.
</ul>

<p><a href="http://nodeguide.com/convincing_the_boss.html">Felix's Node.js Convincing the boss guide</a> has a list of good <em>and</em> bad reasons to use Node.js.


<h2>Installation</h2>

<p>You should already have the pre-requisite software installed:</p>

<table border="1">

<tr>
<td>
<p><strong>Windows or OS&nbsp;X</strong>
</td>
<td>
<p>Use the installation disks that came with your computer to install Windows or OS X.
</td>
<td>
<p>You know it worked if:

<ol>
<li>You see a Start menu or a Dock. If you see penguins, you are probably using Linux and will not be able to use Brackets or Theseus.
</ol>
<p><img src="images/windows-verify.png" />
</td>
</tr>

<tr>
<td>
<p><strong>Node.js</strong>
</td>
<td>
<p><a href="http://nodejs.org/">Use the big install button on their web page</a> to download an installer.
<p><a href="http://nodejs.org/"><img src="images/nodejs.png" /></a>
</td>
<td>
<p>You know it worked if:

<ol>
<li>You can run <tt>node</tt> in a console and get a JavaScript prompt
<li>You can run <tt>npm</tt> in a console and see instructions for how to invoke <tt>npm</tt>
</ol>
<p><img src="images/nodejs-verify.png" />
</td>
</tr>

<tr>
<td>
<p><strong>Brackets</strong><br />(code editor)
</td>
<td>
<p><a href="http://download.brackets.io/">Use the big download button on their web page</a>.
<p><a href="http://download.brackets.io"><img src="images/brackets.png" /></a>
</td>
<td>
<p>You know it worked if:

<ol>
<li>You can launch the Brackets application and see a text editor.
	<br /><strong>OS X:</strong> If OS X says it doesn't trust Brackets, locate Brackets in the Finder and open it by right-clicking and selecting "Open".
</ol>
<p><img src="images/brackets-verify.png" />
</td>
</tr>

<tr>
<td>
<p><strong>Theseus</strong><br />(debugging extension)
</td>
<td>
<p>Theseus:
<ol>
<li>Launch Brackets.
<li>Click the <i>File &gt; Install Extension...</i> menu item.
<li>Paste this URL into the dialog and select OK: <span class="select-all">https://s3.amazonaws.com/alltom/theseus/theseus-0.2.3.zip</span>
<li>Close and re-launch Brackets.
</ol>
<p>node-theseus:
<ol>
<li><strong>Windows:</strong> Open the Command Prompt program and run <tt>npm install -g node-theseus</tt><br /><strong>OS X:</strong> Open a Terminal and run <tt>sudo npm install -g node-theseus</tt>
</ol>
</td>
<td>
<p>You know it worked if:

<ol>
<li>You can launch the Brackets and see a new menu item, <i>Help &gt; Send Theseus Feedback...</i>
<li>When you type <tt>node-theseus</tt> in a terminal, you see instructions for how to run <tt>node-theseus</tt> (ex: <tt>node-theseus [file.js]</tt>)
</ol>
<p><img src="images/theseus-verify.png" />
</td>
</tr>

</table>


<h2 class="section">1. Starting Out with Node.js</h2>

<h3>Overview</h3>

<p>You write JavaScript code in files ending with <tt>.js</tt> and run them in a terminal with a command like <tt>node app.js</tt>.

<h3>Step-By-Step</h3>

<ol class="instructions">

<li><p>Create a folder in a convenient location (such as your desktop) named <tt>node-course</tt>.

<li><p>In Brackets, click the <i>File &gt; Open Folder...</i> menu item and open the folder you created.

<li><p>Click the <i>File &gt; New File...</i> menu item and name the file <tt>app.js</tt>.

<li><p>Type the following code in the file and save it:

<pre class="file">console.log("Hello, World!");</pre>

<li><p>Open a terminal, change to the <tt>node-course</tt> directory, and run the command <tt>node app.js</tt>. It should look like this on OS X:

<pre class="terminal"><span class="prompt">$</span> <span class="input">cd ~/Desktop/node-course</span>
<span class="prompt">$</span> <span class="input">node app.js</span>
Hello, World!</pre>

<p>It should look <em>something like this</em> on Windows:

<pre class="terminal"><span class="prompt">&gt;</span> <span class="input">cd "C:\Documents and Settings\Your Name\Desktop\node-course"</span>
<span class="prompt">&gt;</span> <span class="input">node app.js</span>
Hello, World!</pre>

</ol>


<h2 class="section">2. A Simple Web Server; Debugging With Theseus</h2>

<p>

<h3>Step-By-Step</h3>


<h4>Install Express</h4>

<ol class="instructions">

<li><p>In the terminal you have open in the <tt>node-course</tt> directory, run <tt>npm install express</tt>. It should look like this:

<pre class="terminal"><span class="prompt">$</span> <span class="input">npm install express</span>
<i>[lots of output, ending with...]</i>
express@3.1.0 ./node_modules/express 
├── methods@0.0.1
├── fresh@0.1.0
├── range-parser@0.0.4
├── cookie-signature@0.0.1
├── buffer-crc32@0.1.1
├── cookie@0.0.5
├── debug@0.7.2
├── commander@0.6.1
├── mkdirp@0.3.3
├── send@0.1.0 (mime@1.2.6)
└── connect@2.7.2</pre>

<p>Modules are installed to the current directory by default, in a sub-directory named <tt>node_modules</tt>.

</ol>


<h4>Create a Web Server</h4>

<ol class="instructions">

<li><p>Delete the <tt>console.log</tt> statement we have in <tt>app.js</tt> and replace it with the following code. Hover over the highlighted portions of the code for descriptions of the parts that you'll be changing later.

<pre class="file">var express = require("express");
var app = express();

app.get(<span class="slot" title="This is the URL that you want to respond to. It is relative to the root of the server, so &lt;tt&gt;/&lt;/tt&gt; corresponds to &lt;tt&gt;http://localhost:3000/&lt;/tt&gt; on this server.">'/'</span>, <span class="slot" title="This function will be called every time someone requests the given URL. &lt;br /&gt;&lt;br /&gt; &lt;tt&gt;req&lt;/tt&gt; is short for 'request'. &lt;br /&gt; &lt;tt&gt;res&lt;/tt&gt; is short for 'response'.">function (req, res) {
    res.end("Hello, world!");
}</span>);

app.listen(3000, <span class="slot" title="This function will be called when the server launches. It is an optional argument to &lt;tt&gt;listen&lt;/tt&gt;, so you can leave it out.">function () {
    console.log('Server started at http://localhost:3000/');
}</span>);</pre>

<li><p>Run <tt>node app.js</tt> in the terminal again:

<pre class="terminal"><span class="prompt">$</span> <span class="input">node app.js</span>
Server started at http://localhost:3000/</pre>

<li><p>Does it work? Try visiting <a href="http://localhost:3000/">http://localhost:3000/</a>. You should see "Hello, World!" on the page and nothing else.

</ol>


<h4>Inspect with Theseus</h4>

<ol class="instructions">

<li><p><strong>Kill the web server</strong> by pressing <tt>Ctrl+C</tt> in the terminal.

<li><p>Run the server again, but use <tt>node-theseus</tt> this time:

<pre class="terminal"><span class="prompt">$</span> <span class="input"><strong>node-theseus</strong> app.js</span>
Server started at http://localhost:3000/</pre>

<li><p>Within a few seconds, Brackets should show call counts to the left of every function in the code, like this:

<p><img src="images/theseus.png" />

<p>This is a feature of the extension you installed called <strong>Theseus</strong>.

<li><p>When you refresh <a href="http://localhost:3000/">http://localhost:3000/</a> one or more times, the call counts update in real-time:

<p><img src="images/theseus2.png" />

<li>When you click on one or more of the call counts, a log panel pops up at the bottom of the Brackets window with information about every time those functions were called. It's like adding a log statement retroactively:

<p><img src="images/theseus3.png" />

</ol>


<h3>Debrief</h3>

<p><strong>Install npm packages with <tt>npm install [package-name]</tt></strong>. <i>Express</i> is a Node.js library for creating web servers that you install with npm.

<p><strong>Create a web server</strong> like this:

<pre class="file">var express = require("express");
var app = express();

app.get(<span class="slot" title="This is the URL that you want to respond to. It is relative to the root of the server, so &lt;tt&gt;/&lt;/tt&gt; corresponds to &lt;tt&gt;http://localhost:3000/&lt;/tt&gt; on this server.">'/'</span>, <span class="slot" title="This function will be called every time someone requests the given URL. &lt;br /&gt;&lt;br /&gt; &lt;tt&gt;req&lt;/tt&gt; is short for 'request'. &lt;br /&gt; &lt;tt&gt;res&lt;/tt&gt; is short for 'response'.">function (req, res) {
    res.end("Hello, world!");
}</span>);

app.listen(3000, <span class="slot" title="This function will be called when the server launches. It is an optional argument to &lt;tt&gt;listen&lt;/tt&gt;, so you can leave it out.">function () {
    console.log('Server started at http://localhost:3000/');
}</span>);</pre>

<p><strong>To enable debugging with Theseus</strong> (showing call counts next to the code), launch Node.js with <tt>node-theseus app.js</tt> instead of <tt>node app.js</tt>.


<script src="jquery.js"></script>
<script>
function selectText() {
	if (document.selection) {
		var range = document.body.createTextRange();
		range.moveToElementText(this);
		range.select();
	} else if (window.getSelection) {
		var range = document.createRange();
		range.selectNode(this);
		window.getSelection().addRange(range);
	}
}
$(".select-all").on("click", selectText);
</script>
<script>
var $popup = $("<div class='popup' />").appendTo(document.body).hide();
var popupOwner = undefined;

$(document.body).on("mouseover", "span.slot", function (e) {
	$popup.html($(this).attr("data-description")).show();
	$popup.css({ left: e.pageX + 5, top: e.pageY + 5 });
	popupOwner = this;
});
$(document.body).on("mousemove", "span.slot", function (e) {
	if (popupOwner === this) {
		$popup.css({ left: e.pageX + 5, top: e.pageY + 5 });
	}
});
$(document.body).on("mouseout", "span.slot", function (e) {
	if (popupOwner === this) {
		$popup.hide();
	}
});

$("span.slot").each(function () {
	$(this).attr("data-description", $(this).attr("title"));
	$(this).attr("title", "");
});
</script>
